<app-header [user]="user"></app-header>
<app-chatbot></app-chatbot>
<ngx-spinner type="none">
    <div class="pan-loader">
        <div class="loader"></div>
        <div class="pan-container">
            <div class="pan"></div>
            <div class="handle"></div>
        </div>
    </div>
</ngx-spinner>
<div *ngIf="recipeDetails" class="recipe-detail-container {{ isDark ? 'dark' : '' }} ">
    <div class="container-recipe">
        <a (click)="back()" class="previous round"><i class="fas fa-long-arrow-alt-left"></i></a>
        <section class="section" id="about">
            <div class="container">
                <div class="row mb-5">
                    <div class="col-lg-6 col-md-6 col-xs-12">
                        <div class="left-text-content">
                            <div class="section-heading">
                                <h2>{{recipeDetails.title}}</h2>
                            </div>
                            <div class="container-sum">
                                <div class="detail">
                                    <h2>{{recipeDetails.readyInMinutes}}</h2>
                                    <p>PREPERATION TIME</p>
                                </div>
                                <div class="vl"></div>
                                <div class="detail">
                                    <h2>{{recipeDetails.servings}}</h2>
                                    <p>SERVING DISHES</p>
                                </div>
                                <div class="vl"></div>
                                <div class="detail">
                                    <h2>{{recipeDetails.dishTypes[0]}}</h2>
                                    <p>DISH TYPE</p>
                                </div>
                                <div class="vl"></div>
                                <div class="detail">
                                    <h2>{{recipeDetails.healthScore}} </h2>
                                    <p>HEALTH SCORE</p>
                                </div>
                            </div>
                            <div class="options">
                                <div class="btn_wrap">
                                    <span class="you-would">Save to Recipe Box</span>
                                    <div class="container">

                                        <i class="fas fa-bookmark icon {{flagFav ? 'fav' : ''}}" (click)="btnClickedFav()"></i>

                                        <i onkeypress="return false" (click)="btnClicked()" class="fas fa-share-alt icon"></i>
                                    </div>
                                </div>
                                <div class="wrapper">
                                    <input type="checkbox" />
                                    <div class="btn"><i class="fas fa-info"></i></div>
                                    <div class="tooltip">
                                        <p>Interested in the recipe? Save it</p>
                                        <span>Keep all of your favorite recipes
                                            in one place<br>You also can share the recipe in the community</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-xs-12">
                        <div class="right-content">
                            <div class="thumb">
                                <img src="https://spoonacular.com/recipeImages/{{recipeDetails.id}}-636x393.jpg">
                            </div>
                            <div class="wrapper-star">
                                <p>{{lower}} ratings</p>
                                <input name="ratingRadio" type="radio" id="st1" [class.checked]="rating >=5" />
                                <label for="st1"></label>
                                <input name="ratingRadio" type="radio" id="st2" [class.checked]="rating >=4" />
                                <label for="st2"></label>
                                <input name="ratingRadio" type="radio" id="st3" [class.checked]="rating >=3" />
                                <label for="st3"></label>
                                <input name="ratingRadio" type="radio" id="st4" [class.checked]="rating >=2" />
                                <label for="st4"></label>
                                <input name="ratingRadio" type="radio" id="st5" [class.checked]="rating >=1" />
                                <label for="st5"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <div class="tm-nav-container-outer">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="navbar navbar-expand-lg" id="tm-main-nav">
                        <button class="navbar-toggler toggler-example" type="button" data-toggle="collapse" data-target="#navbar-nav" aria-controls="navbar-nav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="dark-blue-text"><i class="fas fa-bars"></i></span>
                        </button>
                        <div class="collapse navbar-collapse tm-nav text-center" id="navbar-nav">
                            <ul class="navbar-nav ">
                                <li class="nav-item {{flag2? 'active' : ''}}" (click)="ingActive()">
                                    <a class="nav-link tm-nav-link">Ingredients <span
                                            class="sr-only">(current)</span></a>
                                </li>
                                <li class="nav-item {{flag3? 'active' : ''}}" (click)="instActive()">
                                    <a class="nav-link tm-nav-link">Instructions</a>
                                </li>
                                <li class="nav-item {{flag4? 'active' : ''}}" (click)="summActive()">
                                    <a class="nav-link tm-nav-link">Summary</a>
                                </li>
                                <li class="nav-item {{flag7? 'active' : ''}}" (click)="nutActive()">
                                    <a class="nav-link tm-nav-link">Nutrition</a>
                                </li>
                                <li class="nav-item {{flag6? 'active' : ''}}" (click)="revActive()">
                                    <a class="nav-link tm-nav-link">Reviews</a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="flag2 == true">
        <div id="details">
            <div id="first-section">
                <div class="heading">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <h2 class="header-section-title">Ingredients needed for recipe</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="first-section1">
                <div class="container">
                    <div class="row">
                        <div class="triangle"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <section id="cd-timeline" class="cd-container">
                                <div class="cd-timeline-block mb-5">
                                    <div class="cd-timeline-img cd-picture">
                                        <img src="../../../../../assets/images/ingredient.webp" alt="Picture">
                                    </div>
                                    <input id="toggle-on" class="toggle toggle-left" name="toggle" value="us" #measure1 type="radio" checked (change)="toggleMeasure(measure1.value)">
                                    <label for="toggle-on" class="btn">US</label>
                                    <input id="toggle-off" class="toggle toggle-right" name="toggle" value="metric" #measure2 type="radio" (change)="toggleMeasure(measure2.value)">
                                    <label for="toggle-off" class="btn">METRIC</label>
                                    <div class="cd-timeline-content service-box-content mb-5" *ngIf="metricorus=='us';else other_content">
                                        <h6 style="text-transform: capitalize;" *ngFor="let ingredients of recipeDetails.extendedIngredients">
                                            <i class="fas fa-check"></i>{{ingredients.measures.us.amount}} {{ingredients.measures.us.unitShort}} {{ingredients.originalName}}
                                        </h6>
                                    </div>
                                    <ng-template #other_content>
                                        <div class="cd-timeline-content service-box-content mb-5">
                                            <h6 style="text-transform: capitalize;" *ngFor="let ingredients of recipeDetails.extendedIngredients">
                                                <i class="fas fa-check"></i>{{ingredients.measures.metric.amount}} {{ingredients.measures.metric.unitShort}} {{ingredients.originalName}}
                                            </h6>
                                        </div>
                                    </ng-template>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="flag3 == true">
        <div id="details">
            <div id="first-section">
                <div class="heading">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <h2 class="header-section-title">Insructions needed to make the recipe</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="first-section1">
                <div class="container">
                    <div class="row">
                        <div class="triangle"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <section id="cd-timeline" class="cd-container">
                                <div class="cd-timeline-block mb-5" *ngFor="let steps of recipeDetails.analyzedInstructions[0].steps">
                                    <div class="cd-timeline-img cd-picture">
                                        <img src="../../../../../assets/images/step.webp" alt="Picture">
                                    </div>

                                    <div class="cd-timeline-content service-box-content mb-5">
                                        <h6> <i class="fas fa-arrow-right"></i> STEP NUMBER : {{steps.number}}
                                        </h6>
                                        <h6 *ngIf="steps.equipment.length >0">
                                            <i class="fas fa-utensils"></i> Equipment needed :<span style="text-transform: capitalize;" *ngFor="let equipments of steps.equipment;let currentIndex=index">
                                                {{equipments.name}},</span>
                                        </h6>
                                        <h6 *ngIf="steps.ingredients.length >0">
                                            <i class="fas fa-cookie-bite"></i> Ingredients needed :<span style="text-transform: capitalize;" *ngFor="let ingredients of steps.ingredients;let currentIndex=index">
                                                {{ingredients.name}},</span><br>
                                        </h6>
                                        <h6><i class="fas fa-arrow-right"></i> {{steps.step}}</h6>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="flag4 == true">
        <div id="details">
            <div id="first-section">
                <div class="heading">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <h2 class="header-section-title">Summary about recipe</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="first-section1">
                <div class="container">
                    <div class="row">
                        <div class="triangle"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <section id="cd-timeline" class="cd-container">
                                <div class="cd-timeline-block mb-5">
                                    <div class="cd-timeline-img cd-picture">
                                        <img src="../../../../../assets/images/summary.png" alt="Picture">
                                    </div>

                                    <div class="cd-timeline-content service-box-content mb-5">
                                        <h6 [innerHtml]="recipeDetails.summary"></h6>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="flag7 == true">
        <div id="details">
            <div id="first-section">
                <div class="heading">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <h2 class="header-section-title">Nutritional Information</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="first-section1">
                <div class="container">
                    <div class="row">
                        <div class="triangle"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <section id="cd-timeline" class="cd-container">
                                <div class="cd-timeline-block mb-5">
                                    <div class="cd-timeline-img cd-picture">
                                        <img src="../../../../../assets/images/summary.png" alt="Picture">
                                    </div>
                                    <div class="cd-timeline-content service-box-content mb-5">
                                        <h6>Caloric Breakdown</h6>
                                        <div id="chart">
                                            <apx-chart [series]="chartOptions.series" [chart]="chartOptions.chart" [labels]="chartOptions.labels" [responsive]="chartOptions.responsive">
                                            </apx-chart>
                                        </div>
                                    </div>
                                </div>
                                <div class="cd-timeline-block mb-5">
                                    <div class="cd-timeline-img cd-picture">
                                        <img src="../../../../../assets/images/summary.png" alt="Picture">
                                    </div>
                                    <div class="cd-timeline-content service-box-content mb-5">
                                        <h6>Recipe's Nutrients</h6>
                                        <h5 *ngFor="let nutrient of recipeDetails.nutrition.nutrients">
                                            {{nutrient.title}} {{nutrient.amount}}{{nutrient.unit}}
                                            <div class="progress">
                                                <div class="progress-bar bg-secondary" style="color: white;" [style.width.%]="nutrient.percentOfDailyNeeds">
                                                    {{nutrient.percentOfDailyNeeds}}%</div>
                                            </div>
                                        </h5>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="flag6 == true">
        <div id="details">
            <div id="first-section">
                <div class="heading">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <h2 class="header-section-title">Review and rate this recipe</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="first-section1">
                <div class="container">
                    <div class="row">
                        <div class="triangle"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 review-container">
                            <div class="row">
                                <h3 class="note">Rate This Recipe</h3>
                                <ng-container *ngIf="ratedRecipe==0;else other_content">
                                    <div class="wrapper">
                                        <input name="ratingRadio" type="radio" id="st6" value="5" #star1 [disabled]="flagdisable" (click)="sendRate($event);" />
                                        <label for="st6"></label>
                                        <input name="ratingRadio" type="radio" id="st7" value="4" #star2 [disabled]="flagdisable" (click)="sendRate($event);" />
                                        <label for="st7"></label>
                                        <input name="ratingRadio" type="radio" id="st8" value="3" #star3 [disabled]="flagdisable" (click)="sendRate($event);" />
                                        <label for="st8"></label>
                                        <input name="ratingRadio" type="radio" id="st9" value="2" #star4 [disabled]="flagdisable" (click)="sendRate($event);" />
                                        <label for="st9"></label>
                                        <input name="ratingRadio" type="radio" id="st0" value="1" #star5 [disabled]="flagdisable" (click)="sendRate($event);" />
                                        <label for="st0"></label>
                                    </div>
                                </ng-container>
                                <ng-template #other_content>
                                    <div class="wrapper-star">
                                        <input name="ratingRadio" type="radio" id="st5" [class.checked]="ratedRecipe >=5" />
                                        <label for="st6"></label>
                                        <input name="ratingRadio" type="radio" id="st5" [class.checked]="ratedRecipe >=4" />
                                        <label for="st7"></label>
                                        <input name="ratingRadio" type="radio" id="st5" [class.checked]="ratedRecipe >=3" />
                                        <label for="st8"></label>
                                        <input name="ratingRadio" type="radio" id="st5" [class.checked]="ratedRecipe >=2" />
                                        <label for="st9"></label>
                                        <input name="ratingRadio" type="radio" id="st5" [class.checked]="ratedRecipe >=1" />
                                        <label for="st0"></label>
                                    </div>
                                </ng-template>
                            </div>
                            <div class="ui comments">
                                <h3 class="note ui dividing header">Cooking Notes</h3>
                                <form class="ui reply form">
                                    <div class="field">
                                        <textarea class="{{!isDark? 'grey' : ''}}" #review></textarea>
                                    </div>
                                    <div class="ui grey labeled submit icon button color-primary" (click)="addReview(review.value); review.value=''">
                                        <i class="icon edit color-primary"></i> Add Your Review
                                    </div>
                                </form>
                                <ng-container *ngIf="ratingRecipe">
                                    <p class="ui dividing header">All reviews from cookers in the community</p>
                                    <ng-container *ngIf="ratingRecipe.comments.length == 0, else other_content">
                                        <h3>No reviews yet.</h3>
                                    </ng-container>
                                    <ng-template #other_content>
                                        <div #other class="comment" *ngFor="let review of ratingRecipe.comments">
                                            <a class="avatar">
                                                <img [src]="sanitizeImageUrl(review.user.imageURL)">
                                            </a>
                                            <div class="content">
                                                <a routerLink="/community/profile/{{review.user._id}}" class="author">{{review.user.username}}</a>
                                                <div class="text">
                                                    {{review.review}}
                                                </div>
                                            </div>
                                            <hr class="{{isDark? 'dark-color' : 'light-color'}}">

                                        </div>

                                    </ng-template>

                                </ng-container>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- <button class="button" > Create Post</button> -->
    <div class="popup {{  shareToCommunityFlag==true && isSignIn==true ? 'target' : '' }} " id="popup">
        <div style="background-color: black;" class="popup-inner">
            <div class="popup__photo">
                <img src="../../../../../assets/images/post.jpeg" alt="">
            </div>
            <form onsubmit="return false" class="popup__text ui  form">

                <div class="field form-group">
                    <label class="pop-form-label">Post Title</label>
                    <input type="text" #title class="form-control" placeholder="Title" value="{{recipeDetails.title}}">
                </div>
                <div class="field form-group">
                    <label class="pop-form-label">Your Post</label>
                    <textarea #content class="form-control" rows="2" placeholder="Your Post " value="{{currentURL}}"></textarea>
                </div>
                <button (click)="createPost(title.value , content.value)" class="ui black button">Submit</button>
            </form>

            <a class="popup__close" (click)="shareToCommunityFlag = false">X</a>
        </div>
    </div>
    <!-- <button class="button" > Create Post</button> -->
    <div class="popup {{ (shareToCommunityFlag && !isSignIn) ||(favoriteButtonFlag && !isSignIn) || (rateButtonFlag&& !isSignIn) ? 'target' : '' }}" id="popup" class="main-container">
        <div class="popup-inner">
            <div class=" {{ flag ? 'right-panel-active container' : 'container'}}" id="container">
                <div class="form-container sign-up-container">
                    <form (submit)="stopSubmitting()">

                        <input type="text" placeholder="Username" #usernameInput />
                        <input type="email" placeholder="Email" #emailInput />
                        <label class="file">
                            <input name="image" (change)="onFileChanged($event)" type="file" id="file"
                                aria-label="File browser example">
                            <span class="file-custom"></span>
                        </label>
                        <input type="password" placeholder="Password" #passwordInput />

                        <input type="password" placeholder="Confirmed Password" #confirmedPasswordInput />
                        <button (click)="singUp(usernameInput.value, emailInput.value, passwordInput.value, confirmedPasswordInput.value)">Sign
                            Up</button>

                    </form>
                </div>
                <div class="form-container sign-in-container">
                    <form (submit)="stopSubmitting()">
                        <h1>Sign in</h1>
                        <input type="email" placeholder="Email" #emailInputLogin />
                        <input type="password" placeholder="Password" #passwordInputLogin />
                        <!-- <a href="#">Forgot your password?</a> -->
                        <button (click)="login(emailInputLogin.value,passwordInputLogin.value)">Sign In</button>
                    </form>
                </div>
                <div class="overlay-container">
                    <div class="overlay">
                        <div class="overlay-panel overlay-left">
                            <h1>Welcome Back!</h1>
                            <p>To keep connected with us please login with your personal info</p>
                            <button (click)="buttonClicked()" class=" ghost " id="signIn ">Sign In</button>
                        </div>
                        <div class="overlay-panel overlay-right ">
                            <h1>Hello, Friend!</h1>
                            <p>Enter your personal details and start journey with us</p>
                            <button class="ghost " (click)="buttonClicked() " id="signUp ">Sign Up</button>
                        </div>
                    </div>
                </div>
                <a class="popup__close" (click)="shareToCommunityFlag=false;favoriteButtonFlag=false;rateButtonFlag=false;">X</a>
            </div>
        </div>
    </div>
</div>
<app-footer *ngIf="showFooter"></app-footer>